<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.hyrax.microservice.project.data.mapper.LabelMapper">

    <sql id="getBoardId">
        select board_id
        from board
        where board_name = #{boardName}
    </sql>

    <insert id="insert" useGeneratedKeys="true">
        insert into label (board_id, label_name, red, green, blue)
        select (<include refid="getBoardId"/>), #{labelName}, #{red}, #{green}, #{blue}
    </insert>

    <insert id="addLabelToTask">
        insert into task_label (board_id, task_id, label_id)
        select (<include refid="getBoardId"/>), #{taskId}, #{labelId}
    </insert>

    <delete id="delete">
        delete l from board b inner join label l
        on b.board_id = l.board_id and b.board_name = #{boardName} and l.label_id = #{labelId}
    </delete>

</mapper>